DROP TABLE IF EXISTS customers;

CREATE TABLE customers(
    customer_id SERIAL PRIMARY KEY,
    customer_name VARCHAR(50),
    country VARCHAR(50),
    signup_date DATE DEFAULT NOW()
);

INSERT INTO customers(customer_name, country) VALUES
('Chuchu', 'China'),
('Poojitha', 'India'),
('Yewan', 'USA'),
('Sarah', 'UK'),
('Tom', 'India'),
('Lily', 'USA'),
('Max', 'Germany');
DROP TABLE IF EXISTS products;

CREATE TABLE products(
    product_id SERIAL PRIMARY KEY,
    product_name VARCHAR(50),
    price INT
);

INSERT INTO products(product_name, price) VALUES
('Laptop', 1500),
('Mobile', 800),
('Headphones', 150),
('Keyboard', 100),
('Monitor', 300);
DROP TABLE IF EXISTS orders;

CREATE TABLE orders(
    order_id SERIAL PRIMARY KEY,
    customer_id INT REFERENCES customers(customer_id),
    order_date DATE DEFAULT NOW(),
    status VARCHAR(20) DEFAULT 'delivered'
);

INSERT INTO orders(customer_id, order_date, status) VALUES
(1, '2025-11-01', 'delivered'),
(2, '2025-11-03', 'delivered'),
(3, '2025-11-05', 'cancelled'),
(4, '2025-11-06', 'delivered'),
(5, '2025-11-07', 'delivered'),
(6, '2025-11-08', 'pending');
DROP TABLE IF EXISTS order_items;

CREATE TABLE order_items(
    item_id SERIAL PRIMARY KEY,
    order_id INT REFERENCES orders(order_id),
    product_id INT REFERENCES products(product_id),
    quantity INT
);

INSERT INTO order_items(order_id, product_id, quantity) VALUES
(1, 1, 1),  -- Chuchu bought 1 Laptop
(1, 3, 2),  -- Chuchu bought 2 Headphones
(2, 2, 1),  -- Poojitha bought 1 Mobile
(2, 4, 1),  -- Poojitha bought 1 Keyboard
(3, 1, 1),  -- Yewan ordered 1 Laptop (cancelled)
(4, 5, 2),  -- Sarah bought 2 Monitors
(5, 3, 3),  -- Tom bought 3 Headphones
(6, 2, 1);  -- Lily ordered 1 Mobile (pending)

select * from customers;
select * from products;
select * from orders;
select * from order_items;


SELECT  c.customer_name,o.order_id, o.status from 
customers c left join orders o ON
c.customer_id=o.customer_id;
-- List all customers with the product names and quantity they ordered.

select c.customer_name, p.product_name, oi.quantity from 
customers c left join orders o ON
c.customer_id=o.customer_id 
left join order_items oi on o.order_id=oi.order_id
left join products p on p.product_id=oi.product_id 

-- total revenue per customer

select c.customer_name, sum(p.price*oi.quantity)  as revenue from 
customers c left join orders o ON o.customer_id=c.customer_id
left join order_items oi on oi.order_id=o.order_id 
left join products p on p.product_id=oi.product_id
group by c.customer_name;
--total revenue per country
SELECT c.country, sum(p.price*oi.quantity) as country_revenue from customers c 
left join orders o on o.customer_id=c.customer_id
left join order_items oi on o.order_id=oi.order_id
left join products p on p.product_id=oi.product_id
GROUP BY c.country;


